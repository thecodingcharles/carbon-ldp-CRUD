import { IRIResolver } from "../data/IRIResolver";
import { cloneElement } from "../data/utils";
import { PatternBuilder } from "../patterns/PatternBuilder";
import { convertValue } from "../patterns/utils";
import { ValuesToken } from "../tokens/ValuesToken";
import { VariableToken } from "../tokens/VariableToken";
function _normalizeVariables(variableOrVariables) {
    var variables = Array.isArray(variableOrVariables) ? variableOrVariables : [variableOrVariables];
    return variables.map(function (x) { return new VariableToken(x); });
}
function _normalizeRawValues(valuesOrBuilder, iriResolver, isSingle) {
    var rawValues = typeof valuesOrBuilder === "function" ?
        valuesOrBuilder(PatternBuilder.create(iriResolver)) :
        valuesOrBuilder;
    if (!Array.isArray(rawValues))
        return [[rawValues]];
    if (isSingle)
        rawValues.map(function (value) { return [value]; });
    if (rawValues.some(Array.isArray))
        return rawValues;
    return [rawValues];
}
function createValuesFn(genericFactory, container) {
    return function (variableOrVariables, valuesOrBuilder) {
        var token = new ValuesToken();
        var variables = _normalizeVariables(variableOrVariables);
        token.addVariables.apply(token, variables);
        var isSingle = !Array.isArray(variableOrVariables);
        var iriResolver = new IRIResolver(container.iriResolver);
        var values = _normalizeRawValues(valuesOrBuilder, iriResolver, isSingle);
        values.forEach(function (valuesRow) { return token.addValues.apply(token, valuesRow.map(convertValue)); });
        var targetToken = cloneElement(container.targetToken, { values: token });
        var newContainer = cloneElement(container, { iriResolver: iriResolver, targetToken: targetToken });
        return genericFactory(newContainer, {});
    };
}
export var ValuesClause = {
    createFrom: function (genericFactory, container, object) {
        return Object.assign(object, {
            values: createValuesFn(genericFactory, container),
        });
    },
};

//# sourceMappingURL=ValuesClause.js.map

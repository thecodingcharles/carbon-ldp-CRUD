import { IRIResolver } from "../data/IRIResolver";
import { cloneElement } from "../data/utils";
import { PatternBuilder } from "../patterns/PatternBuilder";
import { WhereToken } from "../tokens/WhereToken";
import { GroupClause } from "./GroupClause";
function _getPatterns(iriResolver, patternFunction) {
    var patternOrPatterns = patternFunction(PatternBuilder.create(iriResolver));
    var patterns = Array.isArray(patternOrPatterns) ? patternOrPatterns : [patternOrPatterns];
    return patterns.map(function (x) { return x.getPattern(); });
}
function getWhereFn(genericFactory, container) {
    return function (patternFunction) {
        var _a;
        var iriResolver = new IRIResolver(container.iriResolver);
        var patterns = _getPatterns(iriResolver, patternFunction);
        var query = (_a = cloneElement(container.targetToken.queryClause, { where: new WhereToken() })).addPattern.apply(_a, patterns);
        var queryToken = cloneElement(container.targetToken, { queryClause: query });
        var newContainer = cloneElement(container, { iriResolver: iriResolver, targetToken: queryToken });
        var groupClause = GroupClause.createFrom(genericFactory, newContainer, {});
        return genericFactory(newContainer, groupClause);
    };
}
export var WhereClause = {
    createFrom: function (genericFactory, container, object) {
        return Object.assign(object, {
            where: getWhereFn(genericFactory, container),
        });
    },
};

//# sourceMappingURL=WhereClause.js.map

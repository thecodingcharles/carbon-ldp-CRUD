{"version":3,"sources":["Document/Traits/SPARQLDocumentTrait.ts"],"names":[],"mappings":"AAMA,OAAO,EAAE,cAAc,EAAE,MAAM,4BAA4B,CAAC;AAG5D,OAAO,EAAE,GAAG,EAAE,MAAM,eAAe,CAAC;AAEpC,OAAO,EAAE,iBAAiB,EAAE,MAAM,oCAAoC,CAAC;AAKvE,OAAO,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAC;AAEvC,OAAO,EAAE,iBAAiB,EAAE,MAAM,sBAAsB,CAAC;AA0EzD,SAAS,aAAa,CAAa,QAA4B,EAAE,UAAiB,EAAE,cAAuC,EAAE,OAAuB;IACnJ,IAAI,GAAG,GAAU,QAAQ,CAAC,GAAG,CAAC;IAC9B,IAAI,KAAK,GAAU,UAAU,CAAC;IAE9B,IAAI,QAAQ,CAAE,cAAc,CAAE,EAAG;QAChC,OAAO,GAAG,cAAc,CAAC;KACzB;SAAM,IAAI,cAAc,KAAK,KAAK,CAAC,EAAG;QACtC,KAAK,GAAG,cAAc,CAAC;QACvB,GAAG,GAAG,GAAG,CAAC,OAAO,CAAE,QAAQ,CAAC,GAAG,EAAE,UAAU,CAAE,CAAC;KAC9C;IAGD,OAAO,EAAE,GAAG,KAAA,EAAE,KAAK,OAAA,EAAE,OAAO,SAAA,EAAE,CAAC;AAChC,CAAC;AAaD,MAAM,CAAC,IAAM,mBAAmB,GAA8B;IAC7D,SAAS,EAAE;QACV,gBAAgB,EAAhB,UAA4C,UAAiB,EAAE,cAAuC,EAAE,cAA8B;YAC/H,IAAA,oEAA2F,EAAzF,YAAG,EAAE,gBAAK,EAAE,oBAA6E,CAAC;YAClG,OAAO,IAAI,CAAC,WAAW,CAAC,eAAe,CAAE,GAAG,EAAE,KAAK,EAAE,OAAO,CAAE,CAAC;QAChE,CAAC;QAED,mBAAmB,EAAnB,UAAiE,UAAiB,EAAE,cAAuC,EAAE,cAA8B;YACpJ,IAAA,oEAA2F,EAAzF,YAAG,EAAE,gBAAK,EAAE,oBAA6E,CAAC;YAClG,OAAO,IAAI,CAAC,WAAW,CAAC,kBAAkB,CAAK,GAAG,EAAE,KAAK,EAAE,OAAO,CAAE,CAAC;QACtE,CAAC;QAED,cAAc,EAAd,UAA0C,UAAiB,EAAE,eAAwC,EAAE,cAA8B;YAC9H,IAAA,qEAA4F,EAA1F,YAAG,EAAE,gBAAK,EAAE,oBAA8E,CAAC;YACnG,OAAO,IAAI,CAAC,WAAW,CAAC,aAAa,CAAE,GAAG,EAAE,KAAK,EAAE,OAAO,CAAE,CAAC;QAC9D,CAAC;QAGD,OAAO,EAAP,UAAmC,GAAW;YAC7C,IAAM,IAAI,GAAU,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAE,IAAI,CAAC,GAAG,EAAE,GAAG,CAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC;YAClE,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAE,IAAI,CAAE,CAAC;QACxC,CAAC;KACD;IAED,WAAW,EAAX,UAAa,MAAa;QACzB,OAAO,QAAQ,CAAE,MAAM,CAAE;eACrB,cAAc;iBACf,iBAAiB,CAAE,mBAAmB,CAAC,SAAS,EAAE,MAAM,CAAE,CAC3D;IACH,CAAC;IAED,QAAQ,EAAR,UAA6C,MAAQ;QACpD,IAAI,mBAAmB,CAAC,WAAW,CAAE,MAAM,CAAE;YAAG,OAAO,MAAM,CAAC;QAE9D,IAAM,MAAM,GAA6C,cAAc;aACrE,gBAAgB,CAAE,MAAM,EAAE,iBAAiB,EAAE,iBAAiB,CAAE,CAAC;QAEnE,OAAO,cAAc;aACnB,oBAAoB,CAAE,mBAAmB,CAAC,SAAS,EAAE,MAAM,CAAE,CAAC;IACjE,CAAC;CACD,CAAC","file":"SPARQLDocumentTrait.js","sourcesContent":["import { QueryClause } from \"sparqler/clauses\";\n\nimport { SPARQLDocumentsRepositoryTrait } from \"../../DocumentsRepository/Traits/SPARQLDocumentsRepositoryTrait\";\n\nimport { RequestOptions } from \"../../HTTP/Request\";\n\nimport { ModelDecorator } from \"../../Model/ModelDecorator\";\nimport { ModelPrototype } from \"../../Model/ModelPrototype\";\n\nimport { URI } from \"../../RDF/URI\";\n\nimport { ResolvablePointer } from \"../../Repository/ResolvablePointer\";\n\nimport { SPARQLSelectResults } from \"../../SPARQL/SelectResults\";\nimport { FinishSPARQLAsk, FinishSPARQLSelect } from \"../../SPARQL/SPARQLBuilder\";\n\nimport { isObject } from \"../../Utils\";\n\nimport { TransientDocument } from \"../TransientDocument\";\n\n\n/**\n * Properties for creating a {@link SPARQLDocumentTrait}\n */\nexport interface BaseSPARQLDocumentTrait {\n\t/**\n\t * Repository trait that will to execute requests of the trait to create.\n\t */\n\t$repository:SPARQLDocumentsRepositoryTrait;\n}\n\n/**\n * Trait of a {@link Document} with methods for SPARQL requests.\n */\nexport interface SPARQLDocumentTrait extends TransientDocument, ResolvablePointer {\n\t/**\n\t * Repository trait that actually executes the request of the current trait.\n\t */\n\t$repository:SPARQLDocumentsRepositoryTrait;\n\n\t/**\n\t * Executes an ASK query on the document of the specified URI.\n\t * @param uri URI of the document where to execute the query.\n\t * @param askQuery ASK query to be executed.\n\t * @param requestOptions Customizable options for the request.\n\t */\n\t$executeASKQuery( uri:string, askQuery:string, requestOptions?:RequestOptions ):Promise<boolean>;\n\t/**\n\t * Execute an ASK query on the current document.\n\t * @param askQuery ASK query to be executed.\n\t * @param requestOptions Customizable options for the request.\n\t */\n\t$executeASKQuery( askQuery:string, requestOptions?:RequestOptions ):Promise<boolean>;\n\n\t/**\n\t * Executes a SELECT query on the document of the specified URI.\n\t * @param uri URI of the document where to execute the query.\n\t * @param selectQuery SELECT query to be executed.\n\t * @param requestOptions Customizable options for the request.\n\t */\n\t$executeSELECTQuery<T extends object>( uri:string, selectQuery:string, requestOptions?:RequestOptions ):Promise<SPARQLSelectResults<T>>;\n\t/**\n\t * Executes a SELECT query in the current document.\n\t * @param selectQuery SELECT query to be executed.\n\t * @param requestOptions Customizable options for the request.\n\t */\n\t$executeSELECTQuery<T extends object>( selectQuery:string, requestOptions?:RequestOptions ):Promise<SPARQLSelectResults<T>>;\n\n\t/**\n\t * Executes an UPDATE in the document of the specified URI.\n\t * @param uri URI of the document where to execute the update.\n\t * @param update UPDATE to be executed.\n\t * @param requestOptions Customizable options for the request.\n\t */\n\t$executeUPDATE( uri:string, update:string, requestOptions?:RequestOptions ):Promise<void>;\n\t/**\n\t * Executes an UPDATE in the current document.\n\t * @param update UPDATE to be executed.\n\t * @param requestOptions Customizable options for the request.\n\t */\n\t$executeUPDATE( update:string, requestOptions?:RequestOptions ):Promise<void>;\n\n\n\t/**\n\t * Creates an instance of [SPARQLER](https://github.com/CarbonLDP/sparqler) builder\n\t * for the current document or the one specified by the URI.\n\t * @param uri URI of the document from where to create the query builder.\n\t */\n\t$sparql( uri?:string ):QueryClause<FinishSPARQLSelect, FinishSPARQLAsk>;\n}\n\n\nfunction __parseParams( this:void, resource:SPARQLDocumentTrait, uriOrQuery:string, queryOrOptions?:string | RequestOptions, options?:RequestOptions ):{ uri:string, query:string, options?:RequestOptions } {\n\tlet uri:string = resource.$id;\n\tlet query:string = uriOrQuery;\n\n\tif( isObject( queryOrOptions ) ) {\n\t\toptions = queryOrOptions;\n\t} else if( queryOrOptions !== void 0 ) {\n\t\tquery = queryOrOptions;\n\t\turi = URI.resolve( resource.$id, uriOrQuery );\n\t}\n\n\n\treturn { uri, query, options };\n}\n\n/**\n * Factory, decorator and utils for {@link SPARQLDocumentTrait}.\n */\nexport type SPARQLDocumentTraitFactory =\n\t& ModelPrototype<SPARQLDocumentTrait, TransientDocument & ResolvablePointer>\n\t& ModelDecorator<SPARQLDocumentTrait, BaseSPARQLDocumentTrait>\n\t;\n\n/**\n * Constant that implements {@link SPARQLDocumentTraitFactory}.\n */\nexport const SPARQLDocumentTrait:SPARQLDocumentTraitFactory = {\n\tPROTOTYPE: {\n\t\t$executeASKQuery( this:SPARQLDocumentTrait, uriOrQuery:string, queryOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):Promise<boolean> {\n\t\t\tconst { uri, query, options } = __parseParams( this, uriOrQuery, queryOrOptions, requestOptions );\n\t\t\treturn this.$repository.executeASKQuery( uri, query, options );\n\t\t},\n\n\t\t$executeSELECTQuery<T extends object>( this:SPARQLDocumentTrait, uriOrQuery:string, queryOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):Promise<SPARQLSelectResults<T>> {\n\t\t\tconst { uri, query, options } = __parseParams( this, uriOrQuery, queryOrOptions, requestOptions );\n\t\t\treturn this.$repository.executeSELECTQuery<T>( uri, query, options );\n\t\t},\n\n\t\t$executeUPDATE( this:SPARQLDocumentTrait, uriOrQuery:string, updateOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):Promise<void> {\n\t\t\tconst { uri, query, options } = __parseParams( this, uriOrQuery, updateOrOptions, requestOptions );\n\t\t\treturn this.$repository.executeUPDATE( uri, query, options );\n\t\t},\n\n\n\t\t$sparql( this:SPARQLDocumentTrait, uri?:string ):QueryClause<FinishSPARQLSelect, FinishSPARQLAsk> {\n\t\t\tconst $uri:string = uri ? URI.resolve( this.$id, uri ) : this.$id;\n\t\t\treturn this.$repository.sparql( $uri );\n\t\t},\n\t},\n\n\tisDecorated( object:object ):object is SPARQLDocumentTrait {\n\t\treturn isObject( object )\n\t\t\t&& ModelDecorator\n\t\t\t\t.hasPropertiesFrom( SPARQLDocumentTrait.PROTOTYPE, object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends BaseSPARQLDocumentTrait>( object:T ):T & SPARQLDocumentTrait {\n\t\tif( SPARQLDocumentTrait.isDecorated( object ) ) return object;\n\n\t\tconst target:T & TransientDocument & ResolvablePointer = ModelDecorator\n\t\t\t.decorateMultiple( object, TransientDocument, ResolvablePointer );\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( SPARQLDocumentTrait.PROTOTYPE, target );\n\t},\n};\n"],"sourceRoot":"../../../src"}